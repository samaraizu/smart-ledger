<!DOCTYPE html>
<html>
<head>
  <base href="/">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Smart Ledger - Accounting App">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Smart Ledger</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: white;
    }
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: white;
      z-index: 9999;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #1A237E;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loading-text {
      margin-top: 20px;
      color: #1A237E;
      font-size: 16px;
    }
    #error {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 30px;
      background: white;
      border: 2px solid #f44336;
      border-radius: 8px;
      max-width: 500px;
      text-align: center;
    }
    #error h2 {
      color: #f44336;
      margin-top: 0;
    }
    #error pre {
      text-align: left;
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="loading">
    <div class="spinner"></div>
    <div class="loading-text">Smart Ledger を読み込み中...</div>
  </div>
  
  <div id="error">
    <h2>⚠️ エラーが発生しました</h2>
    <p id="error-message"></p>
    <pre id="error-details"></pre>
    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #1A237E; color: white; border: none; border-radius: 4px; cursor: pointer;">
      再読み込み
    </button>
  </div>

  <script>
    window.addEventListener('error', function(e) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error-message').textContent = e.message || 'Unknown error';
      document.getElementById('error-details').textContent = e.error ? e.error.stack : 'No stack trace available';
      console.error('Error caught:', e);
    });
    
    window.addEventListener('unhandledrejection', function(e) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error-message').textContent = 'Promise rejection: ' + (e.reason?.message || e.reason);
      document.getElementById('error-details').textContent = e.reason?.stack || JSON.stringify(e.reason);
      console.error('Unhandled rejection:', e);
    });
    
    // Timeout after 30 seconds
    setTimeout(function() {
      if (document.getElementById('loading').style.display !== 'none') {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error-message').textContent = 'アプリの読み込みがタイムアウトしました';
        document.getElementById('error-details').textContent = 'ブラウザのコンソール（F12）を開いて、詳細なエラーメッセージを確認してください。';
      }
    }, 30000);
  </script>
  
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
